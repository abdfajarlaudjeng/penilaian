<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Kehadiran Siswa</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin:0; }
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 220px; background: #2d7ae0; color: #fff; padding-top: 32px; box-shadow: 2px 0 10px rgba(0,0,0,0.04); z-index: 10; }
    .sidebar .brand { font-size: 1.24em; font-weight: bold; margin-bottom: 40px; text-align: center; letter-spacing: 1px;}
    .sidebar nav { display: flex; flex-direction: column; gap: 6px;}
    .sidebar nav a { color: #fff; text-decoration: none; padding: 10px 28px; font-size: 1.05em; border-radius: 0 20px 20px 0; transition: background 0.18s, color 0.18s; margin-right: 8px; display: block;}
    .sidebar nav a.active, .sidebar nav a:hover { background: #195ba6; color: #fff; }
    .sidebar .logout-btn { margin: 20px 28px 0 28px; display: block; background: #fff; color: #195ba6; border: 1px solid #195ba6; padding: 8px 0; border-radius: 3px; text-align: center; cursor: pointer; font-size: 1em; transition: background 0.17s, color 0.17s; width: 85%; }
    .sidebar .logout-btn:hover { background: #195ba6; color: #fff; }
    .container-main { margin-left: 240px; max-width: 1050px; padding: 40px 30px; background: #fff; min-height: 100vh; border-radius: 7px; box-shadow: 0 3px 18px rgba(0,0,0,0.07);}
    table, th, td { border: 1px solid #555; border-collapse: collapse; padding: 6px; }
    th { background: #eaeaea; }
    input, select { padding: 3px; margin: 2px; }
    #absensi-form { margin-bottom: 22px; }
    .aksi-btn { margin-right:5px; }
    @media (max-width:850px) {
      .container-main { margin-left: 0; padding: 24px 4vw; }
      .sidebar { position: static; width: 100%; display: flex; flex-direction: row; align-items: center; height: auto; box-shadow: none; }
      .sidebar nav { flex-direction: row; gap: 0; }
      .sidebar nav a { border-radius: 0; padding: 10px 18px; margin: 0; }
      .sidebar .logout-btn { margin: 0 8px; width: unset; }
    }
    @media (max-width:700px){
      .container-main { max-width: 100%; padding: 14px 2px; }
      table { font-size: 0.93em; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="brand">Penilaian Siswa</div>
    <nav>
      <a href="index.html">Beranda</a>
      <a href="penilaian.html">Data Penilaian</a>
      <a href="siswa.html">Data Siswa</a>
      <a href="guru.html">Data Guru</a>
      <a href="absensi.html" class="active">Absensi Siswa</a>
    </nav>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
  <div class="container-main">
    <h2>Absensi Kehadiran Siswa</h2>
    <form id="absensi-form" autocomplete="off">
      <label>Tanggal: <input type="date" id="tanggal" required></label>
      <label>Kelas:
        <select id="kelas" required>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
        </select>
      </label>
      <button type="submit">Tampilkan Daftar Siswa</button>
    </form>
    <form id="absensi-table-form" style="display:none;">
      <table id="tabel-absensi" style="margin-top:10px; width:100%">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Siswa</th>
            <th>NIS</th>
            <th>NISN</th>
            <th>Kehadiran</th>
          </tr>
        </thead>
        <tbody>
        <!-- Data di sini -->
        </tbody>
      </table>
      <button id="simpan-absensi" type="submit" style="margin-top:10px;">Simpan Absensi</button>
    </form>
    <h3 style="margin-top:32px;">Rekap Absensi</h3>
    <table id="rekap-absensi" style="width:100%;margin-top:8px;">
      <thead>
        <tr>
          <th>No</th>
          <th>Tanggal</th>
          <th>Kelas</th>
          <th>Nama Siswa</th>
          <th>Kehadiran</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
<script>
if (!localStorage.getItem('login_user')) window.location.href = "login.html";

let absensi = [];
let siswa = [];

function loadSiswa() {
  try {
    const dt = localStorage.getItem('data_siswa');
    if (dt) siswa = JSON.parse(dt);
    else siswa = [];
  } catch(e){ siswa = []; }
}

function loadAbsensi() {
  try {
    const dt = localStorage.getItem('data_absensi');
    if (dt) absensi = JSON.parse(dt);
    else absensi = [];
  } catch(e){ absensi = []; }
}

function saveAbsensi() {
  localStorage.setItem('data_absensi', JSON.stringify(absensi));
}

function tampilRekap() {
  const tbody = document.querySelector('#rekap-absensi tbody');
  tbody.innerHTML = '';
  absensi.forEach((row, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${row.tanggal}</td>
      <td>${row.kelas}</td>
      <td>${row.nama}</td>
      <td>${row.kehadiran}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById('absensi-form').addEventListener('submit', function(e){
  e.preventDefault();
  loadSiswa();
  const tanggal = document.getElementById('tanggal').value;
  const kelas = document.getElementById('kelas').value;
  if (!tanggal) return;
  const siswaKelas = siswa.filter(s => s.kelas == kelas);
  const tbody = document.querySelector('#tabel-absensi tbody');
  tbody.innerHTML = '';
  siswaKelas.forEach((row, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${row.nama}</td>
      <td>${row.nis}</td>
      <td>${row.nisn}</td>
      <td>
        <select name="kehadiran" required>
          <option value="Hadir">Hadir</option>
          <option value="Izin">Izin</option>
          <option value="Sakit">Sakit</option>
          <option value="Alpa">Alpa</option>
        </select>
        <input type="hidden" name="nama" value="${row.nama}">
        <input type="hidden" name="nis" value="${row.nis}">
        <input type="hidden" name="nisn" value="${row.nisn}">
      </td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById('absensi-table-form').style.display = 'block';
});

document.getElementById('absensi-table-form').addEventListener('submit', function(e){
  e.preventDefault();
  const tanggal = document.getElementById('tanggal').value;
  const kelas = document.getElementById('kelas').value;
  const rows = document.querySelectorAll('#tabel-absensi tbody tr');
  rows.forEach(row => {
    const nama = row.querySelector('input[name="nama"]').value;
    const nis = row.querySelector('input[name="nis"]').value;
    const nisn = row.querySelector('input[name="nisn"]').value;
    const kehadiran = row.querySelector('select[name="kehadiran"]').value;
    // Cek jika sudah ada absensi untuk tanggal/kelas/siswa ini
    const sudahAda = absensi.find(x => x.tanggal===tanggal && x.kelas===kelas && x.nisn===nisn);
    if (sudahAda) {
      sudahAda.kehadiran = kehadiran;
    } else {
      absensi.push({tanggal, kelas, nama, nis, nisn, kehadiran});
    }
  });
  saveAbsensi();
  tampilRekap();
  alert("Absensi berhasil disimpan!");
});

function logout() {
  if (confirm("Anda yakin ingin logout?")) {
    localStorage.removeItem('login_user');
    window.location.href = "login.html";
  }
}

loadAbsensi();
tampilRekap();
</script>
</body>
</html>
