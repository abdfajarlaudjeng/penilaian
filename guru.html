<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Guru</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin:0; }
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 220px; background: #2d7ae0; color: #fff; padding-top: 32px; box-shadow: 2px 0 10px rgba(0,0,0,0.04); z-index: 10; }
    .sidebar .brand { font-size: 1.24em; font-weight: bold; margin-bottom: 40px; text-align: center; letter-spacing: 1px;}
    .sidebar nav { display: flex; flex-direction: column; gap: 6px;}
    .sidebar nav a { color: #fff; text-decoration: none; padding: 10px 28px; font-size: 1.05em; border-radius: 0 20px 20px 0; transition: background 0.18s, color 0.18s; margin-right: 8px; display: block;}
    .sidebar nav a.active, .sidebar nav a:hover { background: #195ba6; color: #fff; }
    .sidebar .logout-btn { margin: 20px 28px 0 28px; display: block; background: #fff; color: #195ba6; border: 1px solid #195ba6; padding: 8px 0; border-radius: 3px; text-align: center; cursor: pointer; font-size: 1em; transition: background 0.17s, color 0.17s; width: 85%; }
    .sidebar .logout-btn:hover { background: #195ba6; color: #fff; }
    .container-main { margin-left: 240px; max-width: 1100px; padding: 40px 30px; background: #fff; min-height: 100vh; border-radius: 7px; box-shadow: 0 3px 18px rgba(0,0,0,0.07);}
    table, th, td { border: 1px solid #555; border-collapse: collapse; padding: 6px; }
    th { background: #eaeaea; }
    input, select { padding: 3px; margin: 2px; }
    #form-guru { margin-bottom: 14px; }
    .aksi-btn { margin-right:5px; }
    .aksi-btn[disabled] { background: #ccc; color: #777; cursor: not-allowed; }
    .foto-thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 50%; border: 1px solid #bbb; background: #eee; }
    .foto-upload { display:inline-block; margin-right:8px; }
    @media (max-width:1200px){
      .container-main { max-width: 100vw;}
      table { font-size: 0.95em;}
    }
    @media (max-width:850px) {
      .container-main { margin-left: 0; padding: 24px 4vw; }
      .sidebar { position: static; width: 100%; display: flex; flex-direction: row; align-items: center; height: auto; box-shadow: none; }
      .sidebar nav { flex-direction: row; gap: 0; }
      .sidebar nav a { border-radius: 0; padding: 10px 18px; margin: 0; }
      .sidebar .logout-btn { margin: 0 8px; width: unset; }
      table { font-size: 0.93em;}
    }
    @media (max-width:700px){
      .container-main { max-width: 100%; padding: 14px 2px; }
      table { font-size: 0.91em; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="brand">Penilaian Siswa</div>
    <nav>
      <a href="index.html">Beranda</a>
      <a href="penilaian.html">Data Penilaian</a>
      <a href="siswa.html">Data Siswa</a>
      <a href="guru.html" class="active">Data Guru</a>
    </nav>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
  <div class="container-main">
    <h2>Data Guru</h2>
    <form id="form-guru">
      <label>Nama Guru: <input type="text" id="nama" required></label>
      <label>NIP: <input type="text" id="nip" required></label>
      <label>NUPTK: <input type="text" id="nuptk" maxlength="16" minlength="8" pattern="\\d*" required></label>
      <label>Status Kepegawaian:
        <select id="status_kepegawaian" required>
          <option value="ASN">ASN</option>
          <option value="GURU HONORER">GURU HONORER</option>
        </select>
      </label>
      <label>Jenjang Pendidikan:
        <input type="text" id="jenjang_pendidikan" required placeholder="S1, S2, D3, dll">
      </label>
      <label>Mata Pelajaran: <input type="text" id="mapel" required></label>
      <label class="foto-upload">Foto:
        <input type="file" id="foto" accept="image/*">
      </label>
      <button type="submit">Tambah Guru</button>
    </form>
    <table id="tabel-guru" style="margin-top:10px; width:100%">
      <thead>
        <tr>
          <th>No</th>
          <th>Foto</th>
          <th>Nama</th>
          <th>NIP</th>
          <th>NUPTK</th>
          <th>Status Kepegawaian</th>
          <th>Jenjang Pendidikan</th>
          <th>Mata Pelajaran</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
<script>
if (!localStorage.getItem('login_user')) window.location.href = "login.html";

let guru = [];
let editIdx = -1;

function updateTable() {
  const tbody = document.querySelector('#tabel-guru tbody');
  tbody.innerHTML = '';
  guru.forEach((row, idx) => {
    let tr = document.createElement('tr');
    if (editIdx === idx) {
      tr.innerHTML = `
        <td>${idx+1}</td>
        <td>
          <img src="${row.foto ? row.foto : ''}" class="foto-thumb" id="edit-foto-preview-${idx}">
          <input type="file" id="edit-foto-${idx}" accept="image/*" style="display:block;margin-top:3px;">
        </td>
        <td><input value="${row.nama}" id="edit-nama"></td>
        <td><input value="${row.nip}" id="edit-nip"></td>
        <td><input value="${row.nuptk}" id="edit-nuptk" maxlength="16" minlength="8" pattern="\\d*"></td>
        <td>
          <select id="edit-status_kepegawaian">
            <option value="ASN"${row.status_kepegawaian=='ASN'?' selected':''}>ASN</option>
            <option value="GURU HONORER"${row.status_kepegawaian=='GURU HONORER'?' selected':''}>GURU HONORER</option>
          </select>
        </td>
        <td><input value="${row.jenjang_pendidikan}" id="edit-jenjang_pendidikan"></td>
        <td><input value="${row.mapel}" id="edit-mapel"></td>
        <td>
          <button class="aksi-btn" onclick="simpanEdit(${idx})">Simpan</button>
          <button class="aksi-btn" onclick="batalEdit()">Batal</button>
        </td>
      `;
      setTimeout(() => {
        document.getElementById(`edit-foto-${idx}`).addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              document.getElementById(`edit-foto-preview-${idx}`).src = ev.target.result;
            }
            reader.readAsDataURL(file);
          }
        });
      }, 10);
    } else {
      tr.innerHTML = `
        <td>${idx+1}</td>
        <td>${row.foto ? `<img src="${row.foto}" class="foto-thumb">` : ''}</td>
        <td>${row.nama}</td>
        <td>${row.nip}</td>
        <td>${row.nuptk}</td>
        <td>${row.status_kepegawaian}</td>
        <td>${row.jenjang_pendidikan}</td>
        <td>${row.mapel}</td>
        <td>
          <button class="aksi-btn" onclick="editData(${idx})">Edit</button>
          <button class="aksi-btn" onclick="hapusGuru(${idx})">Hapus</button>
        </td>
      `;
    }
    tbody.appendChild(tr);
  });
  saveLocal();
}
function editData(idx) {
  editIdx = idx;
  updateTable();
}
function batalEdit() {
  editIdx = -1;
  updateTable();
}
function simpanEdit(idx) {
  let nama = document.getElementById('edit-nama').value.trim();
  let nip = document.getElementById('edit-nip').value.trim();
  let nuptk = document.getElementById('edit-nuptk').value.trim();
  let status_kepegawaian = document.getElementById('edit-status_kepegawaian').value;
  let jenjang_pendidikan = document.getElementById('edit-jenjang_pendidikan').value.trim();
  let mapel = document.getElementById('edit-mapel').value.trim();
  let foto = guru[idx].foto;
  const fileInput = document.getElementById(`edit-foto-${idx}`);
  if (fileInput && fileInput.files[0]) {
    const reader = new FileReader();
    reader.onload = function (ev) {
      foto = ev.target.result;
      finishEdit();
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    finishEdit();
  }

  function finishEdit() {
    if (!nama || !nip || !nuptk || !status_kepegawaian || !jenjang_pendidikan || !mapel) {
      alert("Semua kolom harus diisi!");
      return;
    }
    if (!/^\d+$/.test(nuptk) || nuptk.length < 8 || nuptk.length > 16) {
      alert("NUPTK harus berupa angka 8 sampai 16 digit!");
      return;
    }
    guru[idx] = {nama, nip, nuptk, status_kepegawaian, jenjang_pendidikan, mapel, foto};
    editIdx = -1;
    updateTable();
  }
}
function hapusGuru(idx) {
  if (confirm("Yakin ingin menghapus data ini?")) {
    guru.splice(idx, 1);
    if (editIdx === idx) editIdx = -1;
    updateTable();
  }
}
document.getElementById('form-guru').addEventListener('submit', function(e) {
  e.preventDefault();
  const nama = document.getElementById('nama').value.trim();
  const nip = document.getElementById('nip').value.trim();
  const nuptk = document.getElementById('nuptk').value.trim();
  const status_kepegawaian = document.getElementById('status_kepegawaian').value;
  const jenjang_pendidikan = document.getElementById('jenjang_pendidikan').value.trim();
  const mapel = document.getElementById('mapel').value.trim();
  const fotoInput = document.getElementById('foto');
  if (!nama || !nip || !nuptk || !status_kepegawaian || !jenjang_pendidikan || !mapel) {
    alert("Semua kolom harus diisi!");
    return;
  }
  if (!/^\d+$/.test(nuptk) || nuptk.length < 8 || nuptk.length > 16) {
    alert("NUPTK harus berupa angka 8 sampai 16 digit!");
    return;
  }
  let foto = "";
  if (fotoInput.files && fotoInput.files[0]) {
    const reader = new FileReader();
    reader.onload = function(ev) {
      foto = ev.target.result;
      guru.push({nama, nip, nuptk, status_kepegawaian, jenjang_pendidikan, mapel, foto});
      updateTable();
      document.getElementById('form-guru').reset();
    }
    reader.readAsDataURL(fotoInput.files[0]);
    return;
  }
  guru.push({nama, nip, nuptk, status_kepegawaian, jenjang_pendidikan, mapel, foto});
  updateTable();
  this.reset();
});
function saveLocal() { localStorage.setItem('data_guru', JSON.stringify(guru)); }
function loadLocal() {
  guru = [];
  try {
    const dt = localStorage.getItem('data_guru');
    if (dt) guru = JSON.parse(dt);
  } catch(e){}
}
function logout() {
  if (confirm("Anda yakin ingin logout?")) {
    localStorage.removeItem('login_user');
    window.location.href = "login.html";
  }
}
loadLocal();
updateTable();
</script>
</body>
</html>
